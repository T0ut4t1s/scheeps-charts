# Default values for pgbouncer.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: bitnami/pgbouncer
  tag: 1.24.1
  pullPolicy: IfNotPresent

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

postgresql:
  host: postgresql-cluster-rw.postgres-system.svc.cluster.local
  port: 5432
  username: postgres  # Static username (legacy)
  usernameSecret:     # Username from secret (recommended)
    name: postgresql-superuser
    key: username
  passwordSecret:     # Password from secret
    name: postgresql-superuser
    key: password

auth:
  type: md5  # Changed to md5 for compatibility with automatic hash generation
  poolMode: transaction
  ignoreStartupParameters: ""
  database: ""
  minPoolSize: 5
  
  # New flexible user authentication options
  users: []
    # Example configurations:
    # - name: "app_user"  # Static username
    #   passwordSecret:
    #     name: "app-credentials" 
    #     key: "password"
    # - name: "readonly_user"  # Static username
    #   password: "plain_password"  # Will be auto-hashed to SCRAM
    # - usernameSecret:  # Username from secret
    #     name: "app-credentials"
    #     key: "username"
    #   passwordSecret:
    #     name: "app-credentials"
    #     key: "password"
    # - usernameSecret:  # Username from secret with plain password
    #     name: "readonly-credentials"
    #     key: "username"
    #   password: "plain_password"
  
  # External userlist from ConfigMap or Secret
  externalUserlist:
    enabled: false
    # configMap:  # Pre-built userlist in ConfigMap
    #   name: "pgbouncer-users"
    #   key: "userlist"
    # secret:  # Pre-built userlist in Secret
    #   name: "pgbouncer-users-list"
    #   key: "userlist"
    # secretCredentials:  # Username/password from Secret (auto-generates userlist)
    #   name: "pgbouncer-users-creds"
    #   usernameKey: "username"
    #   passwordKey: "password"
  
  # Legacy static userlist (backward compatibility)
  userlist: |
    "<Username>" "<SCRAM Password>"

tls:
  enabled: true
  serverTlsSecret: pgbouncer-postgres-tls
  sslMode: verify-full

resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 200m
    memory: 256Mi

service:
  type: ClusterIP
  port: 5432

nodeSelector: {}

tolerations: []

affinity: {}

# Security context
securityContext: {}
podSecurityContext: {}
